{% extends '_base.html' %}

{% block page_title %}{{ playground.display_name }} | {% endblock page_title %}

{% block body_class %}playground{% endblock body_class %}

{% block extra_css %}
    {{ CSS.push('css/mapbox.css') }}
{% endblock %}

{% block extra_head %}
    <script type='text/javascript' src="http://api.tiles.mapbox.com/mapbox.js/v1.1.0/mapbox.js"></script>
{% endblock %}

{% block header_content %}
<header>
    <div class="container">
        <div class="row">
            <div class="span12">
                <h1><a href="../">{{ PROJECT_NAME }}</a></h1>
            </div>
        </div>
    </div>
</header>
{% endblock %}

{% block content %}

<div id="editing_thanks" class="alert alert-success alert-block hide">
    <a href="#" class="close" data-dismiss="alert">&times;</a>
    <h4>Thanks!</h4>
    <p>Your changes have been submitted for review.</p>
    <p>Would you mind reviewing another playground?</p>
    <ul>
        <li><a href="#">Park One</a></li>
        <li><a href="#">Park Two</a></li>
        <li><a href="#">Park Three</a></li>
        <li><a href="#">Not Now, Thanks</a></li>
    </ul>
</div>

<h1>{{ playground.display_name }}</h1>

<div class="help-prompt help-prompt-features">
    <p class="prompt"><i class="icon icon-warning-sign"></i>{{ COPY.content.playground_help_key_features }}</p>
    <a href="#edit-playground" role="button" class="btn btn-blue btn-block btn-edit" data-toggle="modal"><i class="icon-pencil"></i> {{ COPY.content.playground_help_button }}</a>
</div>

<!-- Map / Address -->
<div class="address">
    {% if playground.latitude and playground.longitude %}
    <img id="locator-map" data-longitude="{{ playground.longitude }}" data-latitude="{{ playground.latitude }}" />
    {% endif %}
    <div class="address-meta">
        <p>
        {% if playground.address %}{{ playground.address }}{% if playground.address_approximate %} (approximate){% endif %}<br />{% endif %}
        {% if playground.city %}{{ playground.city }}, {% endif %}
        {% if playground.state %}{{ playground.state }} {% endif %}
        {% if playground.zip_code %}{{ playground.zip_code }}{% endif %}
        {% if playground.url %}<br /><a href="{{ playground.url }}">Website</a>{% endif %}
        </p>

        <!-- Directions -->
        {% if playground.address_approximate and playground.latitude and playground.longitude %}
        <p><a href="https://maps.google.com/maps?saddr=&daddr={{ playground.latitude }},{{ playground.longitude }}&z=16" target="_blank" class="btn btn-blue" data-ios-map="http://maps.apple.com/?daddr={{ playground.latitude }},{{ playground.longitude }}" data-ios-gmap="comgooglemaps://?daddr={{ playground.latitude }},{{ playground.longitude }}&views=traffic">Get Driving Directions</a></p>
        {% elif playground.address %}
        <p><a id="directions-link" href="https://maps.google.com/maps?saddr=&daddr={{ playground.address }}+{{ playground.city }}+{{ playground.state }}+{{ playground.zip }}&z=16" target="_blank" class="btn btn-blue" data-ios-map="http://maps.apple.com/?daddr={{ playground.latitude }},{{ playground.longitude }}" data-ios-gmap="comgooglemaps://?daddr={{ playground.latitude }},{{ playground.longitude }}&views=traffic"><i class="icon-road"></i> Get Driving Directions</a></p>
        {% endif %}
    </div>
</div>

{% if playground.features %}
<!-- Categories / key features -->
<div class="playground-features">
    <h4>Key Features</h4>

    <ul>{% for feature in playground.features %}
        <li>{{ feature.cleaned.name }} <i class="icon icon-question-sign" data-toggle="tooltip" title="{{ feature.cleaned.description }}">About</i></li>{% endfor %}
    </ul>

</div>
{% endif %}

<!-- Description -->
<div class="about">
    <h4>About This Playground</h4>
    <p class="description">
    {% if playground.public_remarks %}
        {{ playground.public_remarks }}
    {% else %}
        Description not available.
    {% endif %}
    </p>

    <h5 class="meta">More Info</h5>
    <ul class="meta">
        <li class="agency">
            <strong>Agency:</strong>
            {% if playground.agency %}
                {{ playground.agency }}
                {% if playground.agencytype %} ({{ playground.agencytype }}){% endif %}
            {% else %}
                Unavailable
            {% endif %}
        </li>
        <li class="owner">
            <strong>Owner:</strong>
            {% if playground.owner %}
                {{ playground.owner }}
                {% if playground.owner_type %} ({{ playground.owner_type }}){% endif %}
            {% else %}
                Unavailable
            {% endif %}
        </li>
    </ul>
</div>


<!-- disqus -->
<!-- TODO: add disqus form -->
<div class="comments">
    <h4>{{ COPY.content.playground_note_title }}</h4>
    <p class="description">{{ COPY.content.playground_note_description }}</p>

    {% include '_comments.html' %}
</div>


<!-- Share buttons -->
<ul class="social">
    <li class="facebook"><a rel="external" href="https://www.facebook.com/dialog/feed?app_id={{ FACEBOOK.APP_ID }}&amp;link={{ FACEBOOK.URL }}playground%2F{{ playground.id }}.html&amp;name={{ PROJECT_NAME }}%3A+{{ playground.name }}&amp;picture={{ FACEBOOK.IMAGE_URL }}&amp;redirect_uri={{ FACEBOOK.URL }}" alt="Share on Facebook" target="_blank" onclick="_gaq.push(['_trackEvent', 'Social', 'Click Facebook In Navbar', '{{ PROJECT_NAME }}']);"><span>Like This On Facebook</span><b>Share This</b></a></li>
    <li class="twitter"><a rel="external" href="http://twitter.com/share?text={{ PROJECT_NAME }}%3A+{{ playground.name }}&amp;url={{ TWITTER.URL }}playground%2F{{ playground.id }}.html" alt="Share on Twitter" target="_blank" onclick="_gaq.push(['_trackEvent', 'Social', 'Click Twitter In Navbar', '{{ PROJECT_NAME }}']);"><span>Share This On Twitter</span><b>Tweet This</b></a></li>
</ul>


{% if playground.nearby(1)|length > 0 %}
<!-- nearby parks -->
<div class="nearby">
    <h4>{{ COPY.content.playground_nearby_title }}</h4>
    <ul class="playground-list">
        {% for nearby in playground.nearby(3) %}
        <li>
            <a href="{{ S3_BASE_URL }}{{ url_for('_playground', playground_slug=nearby.slug) }}">{{ nearby.display_name }}</a>
            <span class="distance">
                {{ nearby.distance|round(1) }} miles away |
                {% if nearby.city %}{{ nearby.city }}, {% endif %}{{ nearby.state }}
            </span>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<div class="help-prompt">
    <p class="prompt">{{ COPY.content.playground_help_title }}</p>
    <p><a href="#edit-playground" class="btn btn-blue btn-block" data-toggle="modal"><i class="icon-pencil"></i> {{ COPY.content.playground_help_button }}</a></p>
</div>

<p class="removal">Is this listing inappropriate? <a href="#remove-playground" role="button" data-toggle="modal">Suggest this playground for removal.</a></p>

<p class="learn-more"><a href="../about/">Learn more about NPR's accessible playgrounds project</a></p>


{% if revisions.count() > 0 %}
<div class="changelog">
    <h5>Changelog</h5>
    <ul>
        {% for revision in revisions %}
        <li>
            <span class="timestamp">{{ revision.get_est_time_formatted() }}</span>
            <ul>
                {% if revision.action == 'update' %}
                    {% for change in revision.get_log() %}
                    <li>
                    <strong>{{ display_field_name(change.field) }}</strong> {% if change.from == 0 and change.to == 1 %}selected{% elif change.from == 1 and change.to == 0 %}deselected{% elif not change.from %}set to <em>{{ change.to }}</em>{% elif not change.to %}unset from <em>{{ change.from }}</em>{% else %}changed from <em>{{ change.from }}</em> to <em>{{ change.to }}</em>{% endif %}.
                    </li>
                    {% endfor %}
                {% elif revision.action == 'insert' %}
                    <li>Playground created.</li>
                {% endif %}
            </ul>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}


<!-- update form -->
<div id="edit-playground" class="update-form-modal modal hide fade">
	{% include "_form.html" %}
</div>

<!-- update form -->
<div id="remove-playground" class="remove-form-modal modal hide fade">
	{% include "_form-remove.html" %}
</div>
{% endblock %}

{% block wide_content %}{% endblock %}

{% block scripts%}
{% endblock %}

{% block extra_foot_js %}
    {{ JS.push('js/lib/underscore.js') }}
    {{ JS.push('js/lib/moment.js') }}
    {{ JS.push('js/lib/bootstrap.js') }}
    {{ JS.push('js/templates.js') }}
    {{ JS.push('js/form.js') }}
    {{ JS.push('js/lookup_tables.js') }}
    {{ JS.push('js/utils.js') }}
    {{ JS.render('js/app-edit-footer.min.js') }}
{% endblock extra_foot_js %}
